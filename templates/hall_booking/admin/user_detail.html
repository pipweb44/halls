{% extends 'base.html' %}
{% load static %}
{% block title %}تفاصيل المستخدم{% endblock %}
{% block extra_css %}
<style>
.user-detail-card {
    background: linear-gradient(120deg, #800000 0%, #bfa76a 100%);
    color: #fff;
    border-radius: 28px;
    box-shadow: 0 8px 32px rgba(128,0,0,0.13), 0 2px 8px #bfa76a44;
    padding: 2.5rem 1.5rem 2rem 1.5rem;
    margin-bottom: 2rem;
    position: relative;
    overflow: hidden;
}
.user-detail-card .avatar {
    width: 110px;
    height: 110px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 4px 24px #bfa76a55, 0 2px 8px #80000033;
    border: 4px solid #fffbe6;
    margin-bottom: 1.2rem;
    background: #fffbe6;
    display: inline-block;
}
.user-detail-card .main-info {
    text-align: center;
    margin-bottom: 2rem;
}
.user-detail-card .main-info h3 {
    font-weight: bold;
    font-size: 2rem;
    margin-bottom: 0.3rem;
    color: #ffe066;
    text-shadow: 0 2px 12px #bfa76a33;
}
.user-detail-card .main-info small {
    color: #fffbe6;
    font-size: 1.1rem;
}
.user-detail-card .role-badge {
    font-size: 1.1rem;
    padding: 0.4rem 1.2rem;
    border-radius: 18px;
    font-weight: 600;
    margin-bottom: 0.7rem;
    display: inline-block;
}
.user-detail-card .role-superuser { background: #b30000; color: #fffbe6; }
.user-detail-card .role-staff { background: #bfa76a; color: #800000; }
.user-detail-card .role-user { background: #fffbe6; color: #800000; }
.user-detail-card .status-badge {
    font-size: 1rem;
    padding: 0.3rem 1rem;
    border-radius: 14px;
    font-weight: 600;
    margin-bottom: 0.7rem;
    display: inline-block;
}
.user-detail-card .status-active { background: #229954; color: #fff; }
.user-detail-card .status-inactive { background: #c0392b; color: #fffbe6; }
.user-detail-card .info-list {
    margin: 0 auto 2rem auto;
    max-width: 420px;
    background: #fffbe6;
    border-radius: 18px;
    box-shadow: 0 2px 12px #bfa76a22;
    padding: 1.2rem 1.5rem;
}
.user-detail-card .info-list li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.7rem 0;
    border-bottom: 1px solid #f3e6c6;
    font-size: 1.08rem;
}
.user-detail-card .info-list li:last-child { border-bottom: none; }
.user-detail-card .info-list .icon {
    margin-left: 0.7rem;
    font-size: 1.2rem;
    color: #bfa76a;
}
.user-detail-card .info-list .icon.status { color: #229954; }
.user-detail-card .info-list .icon.status-inactive { color: #c0392b; }
.user-detail-card .info-list .icon.role { color: #bfa76a; }
.user-detail-card .info-list .icon.date { color: #800000; }
.user-detail-card .info-list .icon.login { color: #2980b9; }
.user-detail-card .info-list .icon.email { color: #bfa76a; }
.user-detail-card .info-list .icon.user { color: #800000; }
.user-detail-card .info-list .icon.id { color: #bfa76a; }
.user-detail-card .info-list .value {
    font-weight: 600;
    color: #800000;
}
.user-detail-card .info-list .value.email { direction: ltr; }
.user-detail-card .info-list .value.id { font-size: 0.95rem; color: #bfa76a; }
.user-detail-card .actions {
    display: flex;
    justify-content: space-between;
    margin-top: 2.2rem;
}
.user-detail-card .actions .btn {
    min-width: 110px;
    font-size: 1.08rem;
    font-weight: 600;
    border-radius: 12px;
    box-shadow: 0 2px 8px #bfa76a33;
    transition: background 0.2s, color 0.2s, box-shadow 0.2s;
}
.user-detail-card .actions .btn-primary { background: #bfa76a; color: #800000; border: none; }
.user-detail-card .actions .btn-primary:hover { background: #ffe066; color: #800000; }
.user-detail-card .actions .btn-danger { background: #c0392b; color: #fffbe6; border: none; }
.user-detail-card .actions .btn-danger:hover { background: #800000; color: #fffbe6; }
.user-detail-card .actions .btn-secondary { background: #fffbe6; color: #800000; border: none; }
.user-detail-card .actions .btn-secondary:hover { background: #bfa76a; color: #fff; }
</style>
{% endblock %}
{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7">
            <div class="user-detail-card">
                <div class="main-info">
                    <img src="https://ui-avatars.com/api/?name={{ user_obj.get_full_name|default:user_obj.username }}&background=bfa76a&color=800000&size=220" class="avatar mb-2" alt="أفاتار المستخدم">
                    <h3>{{ user_obj.get_full_name|default:user_obj.username }}</h3>
                    <small class="mb-2">{{ user_obj.email }}</small><br>
                    {% if user_obj.is_superuser %}
                        <span class="role-badge role-superuser"><i class="fas fa-crown me-1"></i> مدير عام</span>
                    {% elif user_obj.is_staff %}
                        <span class="role-badge role-staff"><i class="fas fa-user-shield me-1"></i> مدير</span>
                    {% else %}
                        <span class="role-badge role-user"><i class="fas fa-user me-1"></i> مستخدم</span>
                    {% endif %}
                    {% if user_obj.is_active %}
                        <span class="status-badge status-active"><i class="fas fa-check-circle me-1"></i> نشط</span>
                    {% else %}
                        <span class="status-badge status-inactive"><i class="fas fa-times-circle me-1"></i> غير نشط</span>
                    {% endif %}
                </div>
                <ul class="info-list">
                    <li><span><i class="fas fa-id-badge icon id"></i>رقم المستخدم</span><span class="value id">{{ user_obj.id }}</span></li>
                    <li><span><i class="fas fa-user icon user"></i>اسم المستخدم</span><span class="value">{{ user_obj.username }}</span></li>
                    <li><span><i class="fas fa-envelope icon email"></i>البريد الإلكتروني</span><span class="value email">{{ user_obj.email }}</span></li>
                    <li><span><i class="fas fa-calendar-plus icon date"></i>تاريخ التسجيل</span><span class="value">{{ user_obj.date_joined|date:"Y/m/d H:i" }}</span></li>
                    <li><span><i class="fas fa-sign-in-alt icon login"></i>آخر دخول</span><span class="value">{{ user_obj.last_login|date:"Y/m/d H:i" }}</span></li>
                </ul>
                <div class="actions">
                    <a href="{% url 'hall_booking:admin_users_list' %}" class="btn btn-secondary">رجوع</a>
                    <div>
                        <a href="{% url 'hall_booking:admin_user_edit' user_obj.id %}" class="btn btn-primary me-2">تعديل</a>
                        <a href="{% url 'hall_booking:admin_user_delete' user_obj.id %}" class="btn btn-danger">حذف</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Bookings Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-calendar-check me-2"></i>حجوزات المستخدم</h5>
                    <span class="badge bg-primary">{{ bookings|length }} حجز</span>
                </div>
                <div class="card-body p-0">
                    {% if bookings %}
                    <div class="table-responsive">
                        <table class="table mb-0 align-middle">
                            <thead class="table-light">
                                <tr class="text-nowrap">
                                    <th>#</th>
                                    <th>القاعة</th>
                                    <th>عنوان الحدث</th>
                                    <th>المدة</th>
                                    <th>الحالة</th>
                                    <th>السعر الإجمالي</th>
                                    <th>تاريخ الإنشاء</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for b in bookings %}
                                <tr>
                                    <td>{{ b.id }}</td>
                                    <td>
                                        {% if b.hall %}
                                            <a href="{% url 'hall_booking:hall_detail' b.hall.id %}" class="text-decoration-none">{{ b.hall.name }}</a>
                                        {% else %}
                                            <span class="text-muted">—</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ b.event_title|default:'—' }}</td>
                                    <td>
                                        {{ b.start_datetime|date:"Y/m/d H:i" }}
                                        <span class="text-muted">→</span>
                                        {{ b.end_datetime|date:"Y/m/d H:i" }}
                                    </td>
                                    <td>
                                        {% if b.status == 'pending' %}
                                            <span class="badge bg-warning text-dark">قيد المراجعة</span>
                                        {% elif b.status == 'approved' %}
                                            <span class="badge bg-success">مؤكد</span>
                                        {% elif b.status == 'completed' %}
                                            <span class="badge bg-primary">مكتمل</span>
                                        {% elif b.status == 'cancelled' %}
                                            <span class="badge bg-danger">ملغي</span>
                                        {% else %}
                                            <span class="badge bg-secondary">غير معروف</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ b.total_price|default:0 }}</td>
                                    <td>{{ b.created_at|date:"Y/m/d H:i" }}</td>
                                    <td>
                                        <a href="{% url 'hall_booking:admin_booking_detail' b.id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye me-1"></i> عرض
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <div class="p-4 text-center text-muted">
                            <i class="fas fa-info-circle mb-2"></i>
                            <div>لا توجد حجوزات مرتبطة بهذا المستخدم حالياً.</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}